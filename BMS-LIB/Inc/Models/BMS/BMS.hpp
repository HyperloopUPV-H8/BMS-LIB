/*
 * BMS.hpp
 *
 *  Created on: 14 ene. 2023
 *      Author: aleja
 */

#pragma once

#include "ST-LIB.hpp"
#include "LTC681X/LTC681X.hpp"

class BMS {
public:
	static const uint8_t EXTERNAL_ADCS = 5;
protected:
	enum ADC_MODE : uint8_t {
		FAST = 0b01,
		NORMAL = 0b10,
		FILTERED = 0b11
	};
	enum GPIO_SELECTION {
			ALL = 0b000,
			GPIO_1 = 0b001,
			GPIO_2 = 0b010,
			GPIO_3 = 0b011,
			GPIO_4 = 0b100,
			GPIO_5 = 0b101,
			SECOND_REFERENCE = 0b110
		};
	enum DISCHARGE {
			NOT_PERMITTED = 0,
			PERMITTED = 1
		};
	static const uint8_t DATA_STREAM = LTC681X::COMMAND_DATA_LENGTH*EXTERNAL_ADCS;
public:
	enum COMMAND : uint16_t {
		START_SPI_COMMUNICATION = 0b11100100011,

		READ_CELL_VOLTAGE_REGISTER_A = 0b0100,
		READ_CELL_VOLTAGE_REGISTER_B = 0b0110,
		READ_CELL_VOLTAGE_REGISTER_C = 0b1000,
		READ_CELL_VOLTAGE_REGISTER_D = 0b1010,

		WRITE_CONFIGURATION_REGISTER_GROUP = 0b1,
		READ_CONFIGURATION_REGISTER_GROUP = 0b10,


		READ_AUXILIARY_REGISTER_GROUP_A = 0b00000001100,
		READ_AUXILIARY_REGISTER_GROUP_B = 0b00000001110,

		READ_STATUS_REGISTER_GROUP_A = 0b00000010000,
		MEASURE_INTERNAL_DEVICE_PARAMETERS = 0b10001101000 | (ADC_MODE::NORMAL << 7),

		CHECK_ADC_CONVERSION_STATUS = 0b11100010100,

		START_ADC_CONVERSION_ALL_CELLS = 0b1001100000 | (ADC_MODE::NORMAL << 7) | (DISCHARGE::PERMITTED << 4),
		START_ADC_CONVERSION_ALL_GPIO = 0b10001100000 | (ADC_MODE::NORMAL << 7),
		START_ADC_CONVERSION_GPIO_1 = 0b10001100000 | (ADC_MODE::NORMAL << 7) | (GPIO_SELECTION::GPIO_1),
		START_ADC_CONVERSION_GPIO_2 = 0b10001100000 | (ADC_MODE::NORMAL << 7) | (GPIO_SELECTION::GPIO_2),
		START_ADC_CONVERSION_GPIO_3 = 0b10001100000 | (ADC_MODE::NORMAL << 7) | (GPIO_SELECTION::GPIO_3),
		START_ADC_CONVERSION_GPIO_4 = 0b10001100000 | (ADC_MODE::NORMAL << 7) | (GPIO_SELECTION::GPIO_4),
		START_ADC_CONVERSION_GPIO_5 = 0b10001100000 | (ADC_MODE::NORMAL << 7) | (GPIO_SELECTION::GPIO_5),


	};
};
